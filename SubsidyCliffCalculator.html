<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subsidy Cliff Calculator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles to match the professional, dark-accent theme from the video/images */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .calculator-card {
            background-color: #ffffff;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }
        .header-bg {
            background-color: #79443c; /* Dark, rich brown for professionalism */
            color: white;
            padding: 1.5rem 1.5rem;
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }
        .danger-box {
            background-color: #9A3412; /* Deep terracotta for high alert */
            color: white;
            font-weight: 700;
        }
        .result-value {
            background-color: #ede9e7; /* Light neutral background for results */
            color: #79443c;
            font-size: 1.875rem; /* 3xl */
            font-weight: 800;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-center justify-center">

    <div class="calculator-card max-w-lg w-full rounded-xl overflow-hidden">
        
        <!-- Header -->
        <div class="header-bg">
            <h1 class="text-2xl font-bold">Subsidy Cliff Calculator</h1>
            <p class="text-sm opacity-90 mt-1">2026 Projection (Post-Enhanced PTC Expiration)</p>
        </div>

        <!-- Inputs and Main Content -->
        <div class="p-6 space-y-4">
            <div>
                <label for="projectedIncome" class="block text-sm font-medium text-gray-700">Projected 2026 MAGI ($)</label>
                <input type="number" id="projectedIncome" value="64435" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            
            <div>
                <label for="householdSize" class="block text-sm font-medium text-gray-700">Household Size (1 to 8)</label>
                <input type="number" id="householdSize" value="1" min="1" max="8" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>

            <!-- Calculation Button -->
            <button onclick="calculateCliff()" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out">
                Calculate Risk & Planning Strategy
            </button>

            <!-- Results Section -->
            <div id="results" class="mt-6 space-y-4">
                <h2 class="text-xl font-semibold text-gray-800 border-b pb-2">2026 Forecast & Planning</h2>

                <!-- Row 1: Cliff Status -->
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1 p-3 rounded-lg border border-red-300 text-center">
                        <p class="text-xs font-medium text-red-700">Projected FPL %</p>
                        <p id="fplPercent" class="text-2xl font-extrabold text-red-900 mt-1">--</p>
                    </div>
                    <div class="flex-1 danger-box p-3 rounded-lg text-center">
                        <p class="text-xs font-medium opacity-80">400% FPL Threshold</p>
                        <p id="fplThreshold" class="text-2xl font-extrabold mt-1">--</p>
                    </div>
                </div>

                <!-- Row 2: Crucial Actionable Output (The MAGI Reduction Needed) -->
                <div class="border-2 border-green-600 bg-green-50 p-4 rounded-xl">
                    <p class="text-sm font-semibold text-green-700 uppercase">Strategic Tax Planning Target</p>
                    <div class="flex items-center justify-between mt-1">
                        <p class="text-xl font-bold text-green-800">MAGI Reduction Needed:</p>
                        <p id="magiReduction" class="text-3xl font-extrabold text-green-900">--</p>
                    </div>
                    <p class="text-xs text-green-600 mt-1">To drop MAGI to 399% FPL and restore subsidies.</p>
                </div>

                <!-- Row 3: Financial Impact (The Cost to Avoid) -->
                <div class="p-3 rounded-lg border border-gray-300">
                    <p class="text-sm font-medium text-gray-600">Potential Annual Cost Increase (Loss of Subsidy)</p>
                    <p id="annualCostIncrease" class="text-3xl font-extrabold text-red-600 mt-1">--</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // IRS-VERIFIED FPL DATA (2025 Guidelines for 2026 Coverage)
        // Source: HHS Poverty Guidelines for Contiguous States (Used for ACA MAGI Calculations)
        const FPL_2025 = {
            1: 15650, // Base for 1-person household
            2: 21150,
            3: 26650,
            4: 32150,
            5: 37650,
            6: 43150,
            7: 48650,
            8: 54150,
            // $5,500 for each additional person over 8
        };

        // Projected Cost Estimate (For illustrative purposes, based on the $9,500 figure in the image)
        // Note: Actual calculation involves Benchmark Silver Plan cost, which varies by age/zip.
        const BASE_ANNUAL_SUBSIDY_LOSS = 9500;
        
        /**
         * Simulates the Subsidy Cliff Calculation based on IRS FPL data.
         * Includes the critical 'MAGI Reduction Needed' calculation.
         */
        function calculateCliff() {
            const incomeInput = document.getElementById('projectedIncome');
            const sizeInput = document.getElementById('householdSize');
            
            const projectedMAGI = parseFloat(incomeInput.value);
            let householdSize = parseInt(sizeInput.value);

            // Basic validation
            if (isNaN(projectedMAGI) || projectedMAGI <= 0 || isNaN(householdSize) || householdSize < 1) {
                alert('Please enter valid positive numbers for Projected MAGI and Household Size.');
                return;
            }

            // Determine the 100% FPL for the household size
            let fplBase;
            if (householdSize > 8) {
                // Calculation for households > 8
                fplBase = FPL_2025[8] + (householdSize - 8) * 5500; 
            } else {
                fplBase = FPL_2025[householdSize];
            }
            
            if (!fplBase) {
                alert('Household size calculation error.');
                return;
            }

            // 1. Calculate the critical 400% FPL Threshold (The Cliff)
            const cliffThreshold400 = fplBase * 4.00;
            
            // 2. Calculate projected FPL percentage
            const fplPercent = (projectedMAGI / fplBase) * 100;

            // 3. Determine MAGI Reduction Needed (The Strategic Output)
            let magiReductionNeeded = 0;
            let costImpact = 0;
            let fplStatusText = `${fplPercent.toFixed(1)}% FPL`;

            if (fplPercent > 400.0) {
                // Client is OVER the cliff. Calculate exactly how much MAGI must be reduced 
                // to land just under 400% (e.g., to 399.999...% FPL).
                
                // The target MAGI is the threshold amount: $62,600
                const targetMAGI = cliffThreshold400; 
                
                // The amount they need to contribute to an IRA/HSA to get to the target MAGI
                magiReductionNeeded = projectedMAGI - targetMAGI; 

                // Use the base cost loss, plus a multiplier for higher MAGIs 
                // (simulating the loss being higher the further over the cliff you are).
                const cliffFactor = (fplPercent / 400.0) - 1; // e.g., 411.7% is 1.029 times the cliff
                costImpact = BASE_ANNUAL_SUBSIDY_LOSS + (cliffFactor * 5000); 

                // Update styling for danger status
                document.getElementById('fplPercent').classList.add('text-red-900');
                document.getElementById('fplPercent').classList.remove('text-green-900');
                
            } else {
                // Client is safe (at or under 400% FPL)
                magiReductionNeeded = 0;
                costImpact = 0; 
                fplStatusText += ' - PROTECTED';
                
                document.getElementById('fplPercent').classList.remove('text-red-900');
                document.getElementById('fplPercent').classList.add('text-green-900');
            }

            // 4. Update the Display Results
            document.getElementById('fplPercent').textContent = fplStatusText;
            document.getElementById('fplThreshold').textContent = `$${cliffThreshold400.toLocaleString('en-US')}`;
            
            // The critical actionable output
            if (magiReductionNeeded > 0) {
                document.getElementById('magiReduction').textContent = `$${Math.ceil(magiReductionNeeded).toLocaleString('en-US')}`;
                document.getElementById('magiReduction').parentNode.parentNode.classList.remove('hidden');
            } else {
                document.getElementById('magiReduction').textContent = '— $0 (SAFE) —';
                document.getElementById('magiReduction').parentNode.parentNode.classList.add('border-green-800');
            }

            // Annual Cost Increase
            if (costImpact > 0) {
                document.getElementById('annualCostIncrease').textContent = `$${Math.ceil(costImpact).toLocaleString('en-US')}`;
            } else {
                document.getElementById('annualCostIncrease').textContent = `$0`;
            }
        }

        // Run calculation on load with the default values
        window.onload = function() {
            calculateCliff();
        }
    </script>
</body>
</html>
